!function(e){var t={};function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=6)}([function(e,t){e.exports=require("express")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.JWT_SECRET="behnamBackendDeveloper",t.Msg={Register:"ثبت نام شما با موفقیت انجام شد",loginUserNotFound:"کاربری با این مشخصات وجود ندارد",loginSuccess:"شما با موفقیت وارد شدید.",passwordIncorrect:"پسورد اشتباه است",duplicate:"اطلاعات وارد شده تکراری است",success:"درخواست شما با موفقیت انجام شد",error:"درخواست شما پاسخی ندارد"},t.dbMsgError=(e,t)=>({NotNullField:`فیلد ${e} نمی تواند خالی باشد`,LessThan:`فیلد ${e} نیتواند کمتر از ${t} کاراکتر باشد`,FormatValidation:`فرمت فیلد ${e} به درستی وارد نشده است`})},function(e,t,r){"use strict";(function(t,s){const o=r(13),a=r(14),n=r(15),d=a.basename(t),u=r(16).production,i={};let l;l=u.use_env_variable?new n(process.env[u.use_env_variable],u):new n(u.database,u.username,u.password,u),o.readdirSync(s).filter(e=>0!==e.indexOf(".")&&e!==d&&".js"===e.slice(-3)).forEach(e=>{const t=l.import(a.join(s,e));i[t.name]=t}),Object.keys(i).forEach(e=>{i[e].associate&&i[e].associate(i)}),i.sequelize=l,i.Sequelize=n,e.exports=i}).call(this,"/index.js","/")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.catchError=(e,t)=>{e.status(500).send({error:"An error has occured "+t})},t.loginHandle=(e,t,r,s,o,a)=>e.status(t).send({status:r,token:s,msg:o,redirect:a}),t.successHandle=(e,t,r,s,o)=>{e.status(t).send({status:r,msg:s,result:o})},t.loginValidation=(e,t,r,s,o,a)=>{e.status(t).send({status:r,token:s,msg:o,redirect:a})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditTodo=t.AddTodo=t.LoginValidate=t.RegisterValidate=void 0;var s,o=r(19),a=(s=o)&&s.__esModule?s:{default:s},n=(r(1),r(3));t.RegisterValidate=(e,t,r)=>{const s=a.default.object({userName:a.default.string().required().min(5).messages({"string.empty":"فیلد نام کاربری نمی تواند خالی باشد","string.min":"حداقل طول نام کاربر 5 کاراکتر است"}),email:a.default.string().required().email().messages({"string.empty":"فیلد ایمیل نمی تواند خالی باشد","string.email":"فرمت ایمیل وارد شده صحیح نیست"}),password:a.default.string().required().min(6).messages({"string.empty":"فیلد پسورد نمی تواند خالی باشد","string.min":"پسورد نباید کمتر از 6 کاراکتر باشد"})}).options({abortEarly:!1});s.validate(e.body);let o=s.validate(e.body);if(o.error)return(0,n.successHandle)(t,400,"error",o.error.details[0].message);r()},t.LoginValidate=(e,t,r)=>{const s=a.default.object().keys({email:a.default.string().required().email().messages({"string.empty":"فیلد ایمیل نمی تواند خالی باشد","string.email":"فرمت ایمیل وارد شده صحیح نیست"}),password:a.default.string().required().min(6).messages({"string.empty":"فیلد پسورد نمی تواند خالی باشد","string.min":"پسورد نباید کمتر از 6 کاراکتر باشد"})}).options({abortEarly:!1});s.validate(e.body);let o=s.validate(e.body);if(o.error)return(0,n.loginHandle)(t,400,"error","",o.error.details[0].message,"/login");r()},t.AddTodo=(e,t,r)=>{const s=a.default.object().keys({todoName:a.default.string().required().regex(/^[a-zA-Z0-9]/).min(3).messages({"string.empty":"فیلد نمی تواند خالی باشد","string.min":"todo نباید کمتر از 3 کاراکتر باشد","string.pattern.base":"فقط شامل حروف و عدد باشد"})});s.validate(e.body);let o=s.validate(e.body);if(o.error)return(0,n.successHandle)(t,409,"error",o.error.details[0].message,{});r()},t.EditTodo=(e,t,r)=>{const s=a.default.object().keys({id:a.default.number().required(),Condition:a.default.string().required(),todoName:a.default.string().required().min(3).regex(/^[a-zA-Z0-9]/).messages({"string.empty":"فیلد نمی تواند خالی باشد","string.min":"todo نباید کمتر از 3 کاراکتر باشد","string.pattern.base":"فقط شامل حروف و عدد باشد"})});s.validate(e.body);let o=s.validate(e.body);if(o.error)return(0,n.successHandle)(t,400,"error",o.error.details[0].message,{});r()}},function(e,t){e.exports=require("passport")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(r(0)),o=i(r(7)),a=i(r(8)),n=i(r(9)),d=i(r(5)),u=i(r(10));i(r(4));function i(e){return e&&e.__esModule?e:{default:e}}const l=(0,s.default)();l.use((0,a.default)("dev")),l.use(o.default.urlencoded({extended:!0})),l.use(o.default.json()),l.use((0,n.default)()),l.use(d.default.initialize()),l.use("/",u.default),l.listen(3e3,()=>console.log("Todo app listening at http://localhost:3000")),t.default=l},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("cookie-parser")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(r(0)),o=n(r(11)),a=n(r(20));function n(e){return e&&e.__esModule?e:{default:e}}const d=s.default.Router();d.use("/",a.default),d.use("/user",o.default),t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(r(0)),o=n(r(12)),a=r(4);function n(e){return e&&e.__esModule?e:{default:e}}const d=s.default.Router();d.post("/register",a.RegisterValidate,(e,t)=>{console.log("router"),o.default.registerController(e,t)}),d.post("/login",a.LoginValidate,(e,t)=>{o.default.loginController(e,t)}),t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=u(r(2)),o=u(r(17)),a=u(r(18)),n=r(1),d=r(3);function u(e){return e&&e.__esModule?e:{default:e}}t.default={async registerController(e,t){try{const{userName:r,email:o,password:a}=e.body,u=await s.default.UserModel.findOne({where:{email:o}});if(console.log("jadshflkajdhflajsd"),u)return(0,d.successHandle)(t,400,"error",n.Msg.duplicate);const i=await s.default.UserModel.create({userName:r,email:o,password:a});(0,d.successHandle)(t,201,"success",n.Msg.Register,i)}catch(e){(0,d.catchError)(t,e)}},async loginController(e,t){try{const{email:r,password:u}=e.body,i=await s.default.UserModel.findOne({where:{email:r}});i?await o.default.compare(u,i.password,(e,r)=>{if(r&&!e){i.email;let e="jwt "+a.default.sign(i.toJSON(),n.JWT_SECRET,{expiresIn:"1h"});(0,d.loginHandle)(t,200,"success",e,n.Msg.loginSuccess,"/Todo")}else(0,d.loginHandle)(t,400,"error","",n.Msg.passwordIncorrect,"/login")}):(0,d.loginHandle)(t,400,"error","",n.Msg.loginUserNotFound,"/login")}catch(e){(0,d.catchError)(t,e)}}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("sequelize")},function(e){e.exports=JSON.parse('{"development":{"username":"postgres","password":"behnam","database":"Todo","host":"127.0.0.1","dialect":"postgres"},"test":{"username":"postgres","password":"behnam","database":"Todo","host":"127.0.0.1","dialect":"postgres"},"production":{"username":"postgres","password":"behnam","database":"Todo","host":"127.0.0.1","dialect":"postgres"}}')},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("@hapi/joi")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=d(r(0)),o=r(21),a=d(r(23)),n=r(4);function d(e){return e&&e.__esModule?e:{default:e}}const u=s.default.Router();u.post("/Todo",n.AddTodo,o.jwtAuth,(e,t)=>{a.default.addTodo(e,t)}),u.get("/Todo",o.jwtAuth,(e,t)=>{a.default.getAllTodo(e,t)}),u.put("/Todo",n.EditTodo,o.jwtAuth,(e,t)=>{a.default.editTodo(e,t)}),u.delete("/Todo",o.jwtAuth,(e,t)=>{a.default.deleteTodo(e,t)}),t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jwtAuth=void 0;var s=d(r(5)),o=r(22),a=d(r(2)),n=r(1);function d(e){return e&&e.__esModule?e:{default:e}}const u={jwtFromRequest:o.ExtractJwt.fromAuthHeaderWithScheme("jwt"),secretOrKey:n.JWT_SECRET},i=new o.Strategy(u,async(e,t)=>{try{return t(null,await a.default.UserModel.findOne({where:{email:e.email}}))}catch(e){return t(null,!1)}});s.default.use(i);t.jwtAuth=s.default.authenticate("jwt",{session:!1})},function(e,t){e.exports=require("passport-jwt")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,o=r(2),a=(s=o)&&s.__esModule?s:{default:s},n=r(3),d=r(1);t.default={async addTodo(e,t){try{const{todoName:r}=e.body,{id:s}=e.user,o=await a.default.TodoModel.create({UserModelId:s,todoName:r});(0,n.successHandle)(t,201,"success",d.Msg.success,o)}catch(e){(0,n.catchError)(t,e)}},async editTodo(e,t){try{const{id:r,todoName:s,Condition:o}=e.body,[u,i]=await a.default.TodoModel.update({todoName:s,Condition:o},{where:{id:r},returning:!0});if(0===u||void 0===s||void 0===o)return(0,n.successHandle)(t,400,"error",d.Msg.error,{});(0,n.successHandle)(t,200,"success",d.Msg.success,i[0])}catch(e){(0,n.catchError)(t,e)}},async deleteTodo(e,t){try{const{id:r}=e.query;if(0===await a.default.TodoModel.destroy({where:{id:r}}))return(0,n.successHandle)(t,401,"error",d.Msg.error,{});(0,n.successHandle)(t,200,"success",d.Msg.success,{})}catch(e){(0,n.catchError)(t,e)}},async getAllTodo(e,t){try{const{page:r}=e.query,s=await a.default.TodoModel.findAll({limit:4,offset:4*(r-1),where:{UserModelId:e.user.id},include:[{model:a.default.UserModel,attributes:["id","userName","email"]}]});if(0===s.count)return(0,n.successHandle)(t,200,"error",d.Msg.error,s);(0,n.successHandle)(t,200,"success",d.Msg.success,s)}catch(e){(0,n.catchError)(t,e)}}}}]);